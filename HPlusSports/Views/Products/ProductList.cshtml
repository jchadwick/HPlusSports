@using HPlusSports.Models
@model IEnumerable<HPlusSports.Models.Product>

@{
  var category = (Category)ViewData["Category"];
  ViewBag.Title = category.Name;

  var Ratings = (IEnumerable<ProductRating>)ViewData["Ratings"];
}

<div class="paged-content">

  <h2>@ViewBag.Title</h2>

  <div class="row">

    @foreach (var item in Model)
    {
      var discount = (item.MSRP - item.Price) / item.MSRP;
      var rating = Ratings.FirstOrDefault(x => x.SKU == item.SKU);

      <div class="product-summary col-md-3 text-center">
        <p>
          <a href="@Url.Action("Product", "Products", new { id = item.SKU })">
            <img class="product-image img-thumbnail" src="@Url.Action("Product", "Images", new { id = item.SKU })" />
            <span class="name">@item.Name</span>
          </a>
        </p>
        <p>
          <span class="price">@Html.DisplayFor(modelItem => item.Price)</span>
          <s class="text-muted">@Html.DisplayFor(modelItem => item.MSRP)</s>
          @if (discount > .05)
        {
            <span class="discount label label-primary">
              @discount.ToString("P0") off!
            </span>
          }
        </p>
        <p>
          @if (rating == null || rating.ReviewCount == 0)
        {
            <span><em>No Rating</em></span>
          }
          else
          {
            <span title="@rating.Rating.GetValueOrDefault().ToString("N1")">
              @for (var i = 1; i <= 5; i++)
              {
                var starClass = (rating.Rating >= i) ? "star" : "star-empty";
                <span class="rating-star glyphicon glyphicon-@starClass"></span>
              }
            </span>
            <span>(@rating.ReviewCount)</span>
          }
        </p>
        <p>
          <a class="btn btn-sm btn-warning" href="@Url.Action("Add", "Cart", new { item.SKU })">
            Add To Cart
          </a>
        </p>
      </div>
    }

  </div>


  <div class="pager row">

    <div class="pull-left">@ViewBag.ResultsCount results</div>

    <div class="col-md-4 text-right">

      @if (ViewBag.PreviousPage != null)
      {
        <a data-page-button href="?page=@ViewBag.PreviousPage&count=@ViewBag.PageSize">
          <i class="glyphicon glyphicon-chevron-left"></i>
          Prev.
        </a>
      }
    </div>

    <div class="col-md-2 text-center">
      <span>Page @ViewBag.CurrentPage of @ViewBag.PageCount</span>
    </div>

    <div class="col-md-5 text-left">
      @if (ViewBag.NextPage != null)
      {
        <a data-page-button href="?page=@ViewBag.NextPage&count=@ViewBag.PageSize">
          Next
          <i class="glyphicon glyphicon-chevron-right"></i>
        </a>
      }
    </div>

  </div>

</div>
